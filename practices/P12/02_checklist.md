# P12 — Чек-лист сдачи и критерии (0/★1/★★2)

**Шкала:**

- **0** — не выполнено / сломано;
- **★ 1 (базовый)** — всё запускается, отчёты есть, минимальные меры харднинга применены;
- **★★ 2 (расширенный)** — конфиги подстроены под проект, есть реальные улучшения по итогам сканов.

---

## C1. Hadolint — проверка Dockerfile

**0:**  
Hadolint не запускается, отчёт отсутствует или не относится к вашему `Dockerfile`.

**★ 1:**  
В workflow есть шаг, который запускает Hadolint на вашем `Dockerfile` (через docker-образ или бинарь), отчёт сохраняется в `EVIDENCE/P12/hadolint_report.json`.

**★★ 2:**  

- использован конфиг `security/hadolint.yaml` (например, отключены заведомо нерелевантные правила, включены важные для проекта);
- по крайней мере одно предупреждение проработано (исправлено и проверено повторным запуском).

---

## C2. Checkov — проверка IaC

**0:**  
Checkov не запускается или сканирует пустой/нерелевантный каталог; отчёт либо отсутствует, либо явно не про ваш IaC.

**★ 1:**  
Checkov запускается в CI, сканирует каталог с описанием инфраструктуры (`iac/`, `k8s/`, `deploy/` и т.п.), отчёт сохраняется в `EVIDENCE/P12/checkov_report.json`.

**★★ 2:**  

- `security/checkov.yaml` содержит базовую настройку (например, включение/исключение определённых checks);
- по крайней мере одна находка Checkov осмысленно отработана (исправление в IaC или документированное решение).

---

## C3. Trivy — проверка образа

**0:**  
Trivy не запускается, образ не сканируется, `trivy_report.json` отсутствует.

**★ 1:**  
Trivy запускается в CI по вашему образу (который собирается в том же workflow), отчёт сохраняется в `EVIDENCE/P12/trivy_report.json`.

**★★ 2:**  

- минимум 1–2 критичных/высоких findings разобраны: либо зафиксировано, как вы будете их исправлять (обновление base-образа/пакетов), либо объяснено, почему они не актуальны для вашего случая;
- в описании PR есть короткий summary по результатам Trivy.

---

## C4. Меры харднинга Dockerfile и IaC

**0:**  
`Dockerfile` и IaC оставлены «как были», явных мер харднинга не видно.

**★ 1:**  
Реализованы базовые меры:

- в `Dockerfile`:
  - не используется `latest` без крайней необходимости,
  - реализован хотя бы один шаг по снижению привилегий / уменьшению поверхности атаки;
- в IaC:
  - убран заведомо избыточный доступ (например, «весь мир» на чувствительные ресурсы) там, где это разумно.

**★★ 2:**  
Дополнительно сделано что-то из списка:

- переведён контейнер на non-root user с корректной настройкой прав;
- ограничены capabilities или network/podSecurityContext;
- внедрён простой механизм конфигурирования через переменные окружения/секреты;
- оформлен небольшой `hardening_summary.md` в `EVIDENCE/P12/` с описанием до/после.

---

## C5. Интеграция в CI

**0:**  
Workflow отсутствует или падает до завершения сканов; интеграция случайная.

**★ 1:**  
Есть `.github/workflows/ci-p12-iac-container.yml`:

- разумные триггеры (например, `workflow_dispatch` + `push` по `Dockerfile`, `iac/**`, `security/**`);
- job отрабатывает зелёным;
- все три отчёта попадают в `EVIDENCE/P12/` и в артефакт.

**★★ 2:**  
Workflow аккуратно вписан в общую схему CI:

- настроен `concurrency`, чтобы не копились лишние запуски;
- при необходимости описано, когда запускать P12-проверки (например, по релизным веткам/тегам).

---
