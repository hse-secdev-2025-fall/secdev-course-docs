# Инструкция для студента (P07 — Контейнеризация и базовый харднинг)

## 1) Ветка и структура
1. От `main` создайте ветку `p07-container-hardening`.
2. В корне репозитория добавьте:
   - `Dockerfile` (или положите в `docker/Dockerfile` и обновите пути в CI).
   - `docker-compose.yml` (минимальная сборка/запуск сервиса).
   - при желании `Makefile` или `scripts/run.sh`, `scripts/test_container.sh`.

## 2) Требования к Dockerfile (минимум)
- Базовый образ — slim/distroless/alpine (на выбор) **c указанием версии/диджеста**.
- Слои — минимальные, без dev-инструментов в финальном образе (используйте **multi-stage build**).
- Пользователь **не root** (`USER app`), корректные права на файлы.
- `WORKDIR` задан; `ENTRYPOINT`/`CMD` объявлены явно.
- `HEALTHCHECK` добавлен (curl/exec на порт/endpoint), таймауты/интервалы разумны.
- `.dockerignore` настроен (не тащим `.git`, кэш IDE, тестовые артефакты).
- Повторяемость: пины версий/хешей зависимостей, `--no-cache-dir` и т.п.

## 3) docker-compose.yml
- Минимальный сервис вашего приложения; сеть/порт; переменные окружения через `.env` (без секретов в git).
- Healthcheck (дублирует поведение в Dockerfile или специфичен под compose).

## 4) Проверки (локально и/или в CI)
- **Hadolint** на Dockerfile (или аналогичный линтер).
- **Trivy/Grype/Snyk** — отчёт SCA/SBOM/вулны по образу (как артефакт CI).
- Проверка пользователя процесса: `id -u` в контейнере != 0.
- Проверка healthcheck: контейнер становится **healthy**.

## 5) PR и ревью
- Откройте PR `p07-container-hardening → main` по шаблону, приложите:
  - ссылку на Dockerfile + compose;
  - снимок отчёта линтера и сканера;
  - краткий вывод (что оптимизировали, какой базовый образ выбрали и почему).
- Добейтесь зелёного CI, ответьте на комментарии ревьюера.
