# Архитектурный гайд (минимальная целевая архитектура)

## 1. Слои и зависимости
- **app** (веб-интерфейс API) → зависит от **services** → зависит от **adapters** (БД, почта, внешние API).
- **domain** - модели и инварианты (старайтесь держать чистыми от фреймворков).
- Зависимости направлены «вниз»; внедрение зависимостей через конструкторы/фабрики.

```
src/
  app/            # FastAPI/Flask endpoints, схемы запрос/ответ
  services/       # бизнес-логика, use-cases
  domain/         # модели, сущности, валидаторы
  adapters/       # repo для БД/кэш/внешние API
  shared/         # утилиты, ошибки, id-generator
```

## 2. Конфигурация и секреты
- Конфиг через переменные среды (`APP_ENV`, `DB_URL`), .env не коммитим.
- Секреты - через GitHub Secrets/Environments (см. policies/46).

## 3. Ошибки и исключения
- Своя иерархия исключений в `shared/errors.py`.
- Глобальный перехватчик исключений в `app` → выдаём единый формат ошибок JSON.

## 4. Контракты API
- Явные pydantic-схемы (если FastAPI) или marshmallow.
- Стабильность: любые breaking changes - через ADR и версионирование `/api/v2`.

## 5. Трассируемость
- Ссылки Issue ↔ PR ↔ ADR; в README укажите, где смотреть ADR и чек-листы.

## 6. Definition of Ready (DoR)
- Есть ADR/Issue, архитектурные предпосылки понятны, приёмочные критерии прописаны, есть тест-план.
