# Secure Coding Standards (Python, API-first)

## Валидация и санитизация
- Принимайте **строгие схемы** входа (pydantic/marshmallow).
- Не доверяйте client-side валидации; покрывайте негативные кейсы тестами.

## Аутентификация и авторизация
- Минимум: парольные хэши (bcrypt/argon2), солёные, адекватные параметры.
- Разделяйте AuthN/AuthZ; проверяйте **владельца ресурса** для каждого `id`.
- Токены - короткий TTL; хранение refresh безопасно; revoke при утечке.

## Обработка ошибок
- Единый формат ошибок; без stack trace в ответе.
- Не раскрывайте, «есть ли пользователь» при ошибке логина (избегайте user enumeration).

## Логи и метаданные
- Логируйте минимум, но достаточно для расследований; добавляйте `request_id`.
- Не логируйте пароли/токены/ПДн.

## Секреты и конфигурация
- Переменные среды; ни одного секрета в коде.
- `.env` не коммитим; используем Secret scanning/гейт в CI.

## Зависимости
- Фиксируйте версии (семвер); обновляйте уязвимые пакеты (P09).
- Избегайте экзотических/неподдерживаемых библиотек.

## Пример безопасной проверки владельца
```python
def get_item_for_user(db, item_id: str, user_id: str):
    item = db.items.get(item_id)
    if not item:
        raise NotFound("item")
    if item.owner_id != user_id and not user_is_admin(user_id):
        raise Forbidden("not your resource")
    return item
```
